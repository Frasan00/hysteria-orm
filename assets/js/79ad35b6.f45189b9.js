"use strict";(self.webpackChunkhysteria_orm_docs=self.webpackChunkhysteria_orm_docs||[]).push([[5364],{8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}},8943:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"databases/sql/introduction","title":"SQL ORM Introduction","description":"Hysteria ORM provides a powerful, partially type-safe ORM for SQL databases.","source":"@site/docs/databases/sql/introduction.md","sourceDirName":"databases/sql","slug":"/databases/sql/introduction","permalink":"/hysteria-orm/databases/sql/introduction","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/hysteria-orm/tree/main/website/docs/databases/sql/introduction.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"SQL ORM Introduction","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Logging","permalink":"/hysteria-orm/getting-started/logging"},"next":{"title":"ORM Patterns","permalink":"/hysteria-orm/databases/sql/patterns"}}');var i=s(4848),r=s(8453);const a={title:"SQL ORM Introduction",sidebar_position:1},o="SQL ORM Introduction",l={},c=[{value:"Supported Databases",id:"supported-databases",level:2},{value:"Key Features",id:"key-features",level:2},{value:"Connecting and Disconnecting",id:"connecting-and-disconnecting",level:2},{value:"Creating a Connection",id:"creating-a-connection",level:3},{value:"Configuration Options",id:"configuration-options",level:3},{value:"Secondary Connections",id:"secondary-connections",level:3},{value:"Temporary Connections",id:"temporary-connections",level:3},{value:"Closing Connections",id:"closing-connections",level:3},{value:"Low-Level Access",id:"low-level-access",level:3},{value:"Example Usage",id:"example-usage",level:2},{value:"MSSQL (SQL Server) Some Limitations",id:"mssql-sql-server-some-limitations",level:2},{value:"Transactions",id:"transactions",level:3},{value:"Query Builder",id:"query-builder",level:3},{value:"JSON Queries",id:"json-queries",level:3},{value:"Relations",id:"relations",level:3},{value:"Unique Constraints",id:"unique-constraints",level:3},{value:"UUIDs",id:"uuids",level:3},{value:"Alter statements",id:"alter-statements",level:3},{value:"OracleDB Limitations",id:"oracledb-limitations",level:2},{value:"CLOB Columns",id:"clob-columns",level:3},{value:"Overall Limitations",id:"overall-limitations",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"sql-orm-introduction",children:"SQL ORM Introduction"})}),"\n",(0,i.jsx)(n.p,{children:"Hysteria ORM provides a powerful, partially type-safe ORM for SQL databases."}),"\n",(0,i.jsx)(n.h2,{id:"supported-databases",children:"Supported Databases"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Database"}),(0,i.jsx)(n.th,{children:"Support Level"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"PostgreSQL"}),(0,i.jsx)(n.td,{children:"First-class"}),(0,i.jsx)(n.td,{children:"Full feature support"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"MySQL"}),(0,i.jsx)(n.td,{children:"First-class"}),(0,i.jsx)(n.td,{children:"Full feature support"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLite"}),(0,i.jsx)(n.td,{children:"First-class"}),(0,i.jsx)(n.td,{children:"Some alter table limitations"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"MariaDB"}),(0,i.jsx)(n.td,{children:"First-class"}),(0,i.jsx)(n.td,{children:"MySQL-compatible"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CockroachDB"}),(0,i.jsx)(n.td,{children:"Second-class"}),(0,i.jsx)(n.td,{children:"Some relation query limitations"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"MSSQL"}),(0,i.jsx)(n.td,{children:"Second-class"}),(0,i.jsxs)(n.td,{children:["See ",(0,i.jsx)(n.a,{href:"#mssql-sql-server-some-limitations",children:"limitations"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"OracleDB"}),(0,i.jsx)(n.td,{children:"Experimental"}),(0,i.jsxs)(n.td,{children:["See ",(0,i.jsx)(n.a,{href:"#oracledb-limitations",children:"limitations"})]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Partially type-safe models and queries"}),"\n",(0,i.jsx)(n.li,{children:"Decorator-based schema definition"}),"\n",(0,i.jsx)(n.li,{children:"Advanced query builder (Knex-like)"}),"\n",(0,i.jsx)(n.li,{children:"Migrations and schema management"}),"\n",(0,i.jsxs)(n.li,{children:["Relations: ",(0,i.jsx)(n.code,{children:"hasOne"}),", ",(0,i.jsx)(n.code,{children:"hasMany"}),", ",(0,i.jsx)(n.code,{children:"belongsTo"}),", ",(0,i.jsx)(n.code,{children:"manyToMany"})]}),"\n",(0,i.jsx)(n.li,{children:"Transactions: global, nested, concurrent"}),"\n",(0,i.jsx)(n.li,{children:"Hooks and lifecycle events"}),"\n",(0,i.jsx)(n.li,{children:"Factory support for testing and seeding"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"connecting-and-disconnecting",children:"Connecting and Disconnecting"}),"\n",(0,i.jsx)(n.p,{children:"Hysteria ORM provides flexible methods to manage your SQL database connections:"}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-connection",children:"Creating a Connection"}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"SqlDataSource"})," class to create and establish database connections:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { SqlDataSource } from 'hysteria-orm';\n\n// Create instance with configuration\nconst sql = new SqlDataSource({\n  type: 'postgres',\n  host: 'localhost',\n  port: 5432,\n  username: 'user',\n  password: 'pass',\n  database: 'mydb',\n  logs: true,\n});\n\n// Establish the connection (sets as primary instance for models)\nawait sql.connect();\n"})}),"\n",(0,i.jsx)(n.p,{children:"If no configuration is provided, environment variables are used:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { SqlDataSource } from 'hysteria-orm';\n\n// Uses DB_TYPE, DB_HOST, DB_PORT, DB_USER, DB_PASSWORD, DB_DATABASE from env\nconst sql = new SqlDataSource();\nawait sql.connect();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const sql = new SqlDataSource({\n  type: 'postgres',\n  host: 'localhost',\n  port: 5432,\n  username: 'user',\n  password: 'pass',\n  database: 'mydb',\n  logs: true,\n  // Embedded models that can be used directly from the sql data source instance\n  models: {\n    user: User,\n    post: Post,\n  },\n  // Retry policy for failed queries\n  connectionPolicies: {\n    retry: {\n      maxRetries: 3,\n      delay: 1000,\n    },\n  },\n  // Query format options for logging\n  queryFormatOptions: {\n  // sql-formatter options\n  },\n  // Driver-specific options (mysql2, pg, sqlite3, etc.)\n  driverOptions: {\n  // Depends on database type\n  },\n  // Migration configuration for the sql data source\n  migrations: {\n    path: 'database/migrations',\n    lock: true,\n    transactional: true,\n  },\n  // Seeder configuration for the sql data source\n  seeders: {\n    path: 'database/seeders',\n    tsconfig: './tsconfig.json',\n  },\n  });\n"})}),"\n",(0,i.jsx)(n.h3,{id:"secondary-connections",children:"Secondary Connections"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"SqlDataSource.connectToSecondarySource()"})," for additional connections that don't become the primary instance:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { SqlDataSource } from 'hysteria-orm';\n\nconst replicaDb = await SqlDataSource.connectToSecondarySource({\n  type: 'postgres',\n  host: 'replica.db.com',\n  port: 5432,\n  username: 'user',\n  password: 'pass',\n  database: 'mydb',\n});\n\n// Use with models by passing the connection\nconst users = await User.query({ connection: replicaDb }).many();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"temporary-connections",children:"Temporary Connections"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"SqlDataSource.useConnection()"})," for connections that automatically close after use:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { SqlDataSource } from 'hysteria-orm';\n\nawait SqlDataSource.useConnection({\ntype: 'mysql',\nhost: 'localhost',\nport: 3306,\nusername: 'user',\npassword: 'pass',\ndatabase: 'tempdb',\n}, async (sql) => {\n// Connection is available here\nconst users = await User.query({ connection: sql }).many();\n});\n// Connection is automatically closed\n"})}),"\n",(0,i.jsx)(n.h3,{id:"closing-connections",children:"Closing Connections"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Close the primary connection\nawait SqlDataSource.closeConnection();\n// or\nawait SqlDataSource.disconnect();\n\n// Close a specific instance\nawait sql.closeConnection();\n// or\nawait sql.disconnect();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"low-level-access",children:"Low-Level Access"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Get a connection from the pool\nconst connection = await sql.getConnection();\n\n// Get the underlying pool/driver instance\nconst pool = sql.getPool();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { SqlDataSource } from 'hysteria-orm';\nimport { User } from './models/User';\n\nconst sql = new SqlDataSource({\n  type: 'postgres',\n  host: 'localhost',\n  port: 5432,\n  username: 'root',\n  password: 'root',\n  database: 'mydb',\n});\n\nawait sql.connect();\n\n// Now models use this connection by default\nconst users = await User.query().many();\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"mssql-sql-server-some-limitations",children:"MSSQL (SQL Server) Some Limitations"}),"\n",(0,i.jsx)(n.p,{children:"MSSQL is supported as a second-class database. The following and potentially other limitations apply:"}),"\n",(0,i.jsx)(n.h3,{id:"transactions",children:"Transactions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Single request per transaction"}),": MSSQL only allows one active request per transaction at a time. Operations that run queries in parallel (like ",(0,i.jsx)(n.code,{children:"paginate()"}),") are automatically serialized when running inside a transaction."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pessimistic locking"}),": Uncommitted writes block reads from other connections on the same table."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"query-builder",children:"Query Builder"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Recursive CTEs"}),": MSSQL doesn't use the ",(0,i.jsx)(n.code,{children:"RECURSIVE"})," keyword - recursion is implicit."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Empty ",(0,i.jsx)(n.code,{children:"whereIn"}),"/",(0,i.jsx)(n.code,{children:"whereNotIn"})]}),": Empty arrays generate invalid SQL and should be avoided."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"whereRegexp"})}),": Not supported - MSSQL doesn't have a native ",(0,i.jsx)(n.code,{children:"REGEXP"})," operator."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lock clauses"}),": Uses different syntax (",(0,i.jsx)(n.code,{children:"WITH (UPDLOCK)"})," hints) than other databases."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"json-queries",children:"JSON Queries"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Limited JSON support"}),": MSSQL uses ",(0,i.jsx)(n.code,{children:"CHARINDEX"})," for JSON queries, which only performs exact substring matching."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Not supported"}),": Partial JSON object matching, ",(0,i.jsx)(n.code,{children:"whereJsonContains"}),", nested property queries with complex conditions."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"relations",children:"Relations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"HasMany/ManyToMany with limit/offset"}),': May fail with "Ambiguous column name" errors when using ',(0,i.jsx)(n.code,{children:"orderByRaw"})," with unqualified column names. Always use fully qualified column names (e.g., ",(0,i.jsx)(n.code,{children:"table.column"}),") in ",(0,i.jsx)(n.code,{children:"orderByRaw"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"unique-constraints",children:"Unique Constraints"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"NULL handling"}),": MSSQL considers multiple ",(0,i.jsx)(n.code,{children:"NULL"})," values as duplicates for ",(0,i.jsx)(n.code,{children:"UNIQUE"})," constraints, unlike PostgreSQL."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"uuids",children:"UUIDs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Case sensitivity"}),": MSSQL returns UUIDs in uppercase. Comparisons should use case-insensitive matching."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"alter-statements",children:"Alter statements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Limited support"}),": Some issues could arise in alter table statements that can lead to have to write raw sql."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["Next: ",(0,i.jsx)(n.a,{href:"/hysteria-orm/databases/sql/patterns",children:"ORM Patterns"})]}),"\n",(0,i.jsx)(n.h2,{id:"oracledb-limitations",children:"OracleDB Limitations"}),"\n",(0,i.jsx)(n.p,{children:"OracleDB is supported as a partial-class database. The following and potentially other limitations apply:"}),"\n",(0,i.jsx)(n.h3,{id:"clob-columns",children:"CLOB Columns"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cannot be used in WHERE comparisons"}),": CLOB columns cannot be used in WHERE comparisons."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"overall-limitations",children:"Overall Limitations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Some features may not work as expected"}),": Some features may not work as expected due to the differences in the database."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Raw SQL may be required"}),": Raw SQL may be required to achieve the desired result in both DDL and DML statements."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);