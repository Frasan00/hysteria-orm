"use strict";(self.webpackChunkhysteria_orm_docs=self.webpackChunkhysteria_orm_docs||[]).push([[5364],{8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},8943:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"databases/sql/introduction","title":"SQL ORM Introduction","description":"Hysteria ORM provides a powerful, partially type-safe ORM for SQL databases.","source":"@site/docs/databases/sql/introduction.md","sourceDirName":"databases/sql","slug":"/databases/sql/introduction","permalink":"/hysteria-orm/docs/databases/sql/introduction","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/hysteria-orm/tree/main/website/docs/databases/sql/introduction.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"SQL ORM Introduction","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Logging","permalink":"/hysteria-orm/docs/getting-started/logging"},"next":{"title":"ORM Patterns","permalink":"/hysteria-orm/docs/databases/sql/patterns"}}');var t=s(4848),r=s(8453);const o={title:"SQL ORM Introduction",sidebar_position:1},l="SQL ORM Introduction",a={},c=[{value:"Supported Databases",id:"supported-databases",level:2},{value:"First-Class Support",id:"first-class-support",level:3},{value:"First-Class Support (but with limitations)",id:"first-class-support-but-with-limitations",level:3},{value:"Second-Class Support",id:"second-class-support",level:3},{value:"Key Features",id:"key-features",level:2},{value:"Connecting and Disconnecting",id:"connecting-and-disconnecting",level:2},{value:"Example Usage",id:"example-usage",level:2},{value:"MSSQL (SQL Server) Some Limitations",id:"mssql-sql-server-some-limitations",level:2},{value:"Transactions",id:"transactions",level:3},{value:"Query Builder",id:"query-builder",level:3},{value:"JSON Queries",id:"json-queries",level:3},{value:"Relations",id:"relations",level:3},{value:"Unique Constraints",id:"unique-constraints",level:3},{value:"UUIDs",id:"uuids",level:3},{value:"Alter statements",id:"alter-statements",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"sql-orm-introduction",children:"SQL ORM Introduction"})}),"\n",(0,t.jsx)(n.p,{children:"Hysteria ORM provides a powerful, partially type-safe ORM for SQL databases."}),"\n",(0,t.jsx)(n.h2,{id:"supported-databases",children:"Supported Databases"}),"\n",(0,t.jsx)(n.h3,{id:"first-class-support",children:"First-Class Support"}),"\n",(0,t.jsx)(n.p,{children:"These databases are fully tested and recommended for production use:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"PostgreSQL"})," - Full feature support"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"MySQL"})," - Full feature support"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"first-class-support-but-with-limitations",children:"First-Class Support (but with limitations)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SQLite"})," - Full feature support with some limitations with alter table statements"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"MariaDB"})," - Compatible with MySQL, minor differences may exist"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"second-class-support",children:"Second-Class Support"}),"\n",(0,t.jsx)(n.p,{children:"These databases are supported but may have limitations or require workarounds for certain features:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CockroachDB"})," - PostgreSQL-compatible, some features like certain relation queries with limit/offset may not work"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"MSSQL (SQL Server)"})," - Supported with known limitations (see below)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Partially Type-safe models and queries"}),"\n",(0,t.jsx)(n.li,{children:"Decorator-based schema definition"}),"\n",(0,t.jsx)(n.li,{children:"Advanced query builder"}),"\n",(0,t.jsx)(n.li,{children:"Migrations and schema management"}),"\n",(0,t.jsx)(n.li,{children:"Rich relation support (hasOne, hasMany, belongsTo, manyToMany)"}),"\n",(0,t.jsx)(n.li,{children:"Transaction management (global, nested, concurrent)"}),"\n",(0,t.jsx)(n.li,{children:"Hooks and lifecycle events"}),"\n",(0,t.jsx)(n.li,{children:"Factory support for testing and seeding"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"connecting-and-disconnecting",children:"Connecting and Disconnecting"}),"\n",(0,t.jsx)(n.p,{children:"Hysteria ORM provides flexible methods to manage your SQL database connections:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"sql.connect([config], [callback])"})}),"\nEstablishes the default connection used by all models."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Creates the default singleton connection used by all models, designed to be called only once"}),"\n",(0,t.jsx)(n.li,{children:"If no config is provided, environment variables are used."}),"\n",(0,t.jsx)(n.li,{children:"Optionally, you can pass a callback to run after connection."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { sql } from 'hysteria-orm';\n\n// Using environment variables, will be used from every model by default\nawait sql.connect();\n\n// Or with configuration\nconst sql = await sql.connect({\n  type: 'postgres',\n  host: 'localhost',\n  port: 5432,\n  username: 'user',\n  password: 'pass',\n  database: 'mydb',\n  // Embedded models that can be used directly from the sql data source instance and to generate openapi schemas\n  models: {\n    user: User,\n  },\n  connectionPolicies: {\n    retry: {\n      // Retry policy for queries\n      maxRetries: 3,\n      // Delay between retries\n      delay: 1000,\n    },\n  },\n  queryFormatOptions: {\n    // Query format options\n  },\n  driverOptions: {\n    // Driver specific options depending on the database type (e.g. mysql2 options, pg options etc.)\n  },\n});\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"sql.connectToSecondarySource([config], [callback])"})}),"\nOpens a separate connection (not the global one used by models).\nUseful for migrations, background jobs, or multi-database scenarios."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// `connectToSecondarySource` must have connection options provided\nconst anotherDb = await sql.connectToSecondarySource({\n  type: 'mysql',\n  host: 'localhost',\n  port: 3306,\n  username: 'user',\n  password: 'pass',\n  database: 'otherdb',\n});\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"sql.closeConnection()"})," / ",(0,t.jsx)(n.code,{children:"sql.disconnect()"})]}),"\nCloses the current (default) connection."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"await sql.closeConnection();\n// or\nawait sql.disconnect();\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"sql.getConnection()"})}),"\nReturns a single connection from the pool (SQLite returns the Database instance). The caller is responsible for using it within transactions and ensuring proper lifecycle via transaction helpers."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const connection = await sql.getConnection();\n\n// Type utility for specific connection types\nconst mysqlConnection = await sql.getConnection("mysql");\nconst pgConnection = await sql.getConnection("postgres");\nconst sqliteConnection = await sql.getConnection("sqlite");\nconst mssqlConnection = await sql.getConnection("mssql");\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"sql.getPool()"})}),"\nReturns the underlying pool/driver instance (SQLite returns the Database instance). Use this for low-level operations only."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const pool = sql.getPool();\n\n// Type utility for specific connection types\nconst mysqlPool = sql.getPool("mysql");\nconst pgPool = sql.getPool("postgres");\nconst sqliteDb = sql.getPool("sqlite");\nconst mssqlPool = sql.getPool("mssql");\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { sql } from 'hysteria-orm';\nawait sql.connect();\n\nimport { User } from './models/User';\nconst users = await User.query().many();\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"mssql-sql-server-some-limitations",children:"MSSQL (SQL Server) Some Limitations"}),"\n",(0,t.jsx)(n.p,{children:"MSSQL is supported as a second-class database. The following and potentially other limitations apply:"}),"\n",(0,t.jsx)(n.h3,{id:"transactions",children:"Transactions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Single request per transaction"}),": MSSQL only allows one active request per transaction at a time. Operations that run queries in parallel (like ",(0,t.jsx)(n.code,{children:"paginate()"}),") are automatically serialized when running inside a transaction."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pessimistic locking"}),": Uncommitted writes block reads from other connections on the same table."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"query-builder",children:"Query Builder"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Recursive CTEs"}),": MSSQL doesn't use the ",(0,t.jsx)(n.code,{children:"RECURSIVE"})," keyword - recursion is implicit."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Empty ",(0,t.jsx)(n.code,{children:"whereIn"}),"/",(0,t.jsx)(n.code,{children:"whereNotIn"})]}),": Empty arrays generate invalid SQL and should be avoided."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"whereRegexp"})}),": Not supported - MSSQL doesn't have a native ",(0,t.jsx)(n.code,{children:"REGEXP"})," operator."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Lock clauses"}),": Uses different syntax (",(0,t.jsx)(n.code,{children:"WITH (UPDLOCK)"})," hints) than other databases."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"json-queries",children:"JSON Queries"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Limited JSON support"}),": MSSQL uses ",(0,t.jsx)(n.code,{children:"CHARINDEX"})," for JSON queries, which only performs exact substring matching."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Not supported"}),": Partial JSON object matching, ",(0,t.jsx)(n.code,{children:"whereJsonContains"}),", nested property queries with complex conditions."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"relations",children:"Relations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"HasMany/ManyToMany with limit/offset"}),': May fail with "Ambiguous column name" errors when using ',(0,t.jsx)(n.code,{children:"orderByRaw"})," with unqualified column names. Always use fully qualified column names (e.g., ",(0,t.jsx)(n.code,{children:"table.column"}),") in ",(0,t.jsx)(n.code,{children:"orderByRaw"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"unique-constraints",children:"Unique Constraints"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"NULL handling"}),": MSSQL considers multiple ",(0,t.jsx)(n.code,{children:"NULL"})," values as duplicates for ",(0,t.jsx)(n.code,{children:"UNIQUE"})," constraints, unlike PostgreSQL."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"uuids",children:"UUIDs"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Case sensitivity"}),": MSSQL returns UUIDs in uppercase. Comparisons should use case-insensitive matching."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"alter-statements",children:"Alter statements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Limited support"}),": Some issues could arise in alter table statements that can lead to have to write raw sql."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:["Next: ",(0,t.jsx)(n.a,{href:"/hysteria-orm/docs/databases/sql/patterns",children:"ORM Patterns"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);