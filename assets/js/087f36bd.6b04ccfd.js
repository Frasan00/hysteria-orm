"use strict";(self.webpackChunkhysteria_orm_docs=self.webpackChunkhysteria_orm_docs||[]).push([[7521],{8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>d});var t=s(6540);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}},9289:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"databases/sql/models/instance-methods","title":"Instance Methods","description":"Hysteria ORM models provide instance methods that allow you to work with individual model instances. These methods operate on the model instance itself and require the model to have a primary key defined.","source":"@site/docs/databases/sql/models/instance-methods.md","sourceDirName":"databases/sql/models","slug":"/databases/sql/models/instance-methods","permalink":"/hysteria-orm/databases/sql/models/instance-methods","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/hysteria-orm/tree/main/website/docs/databases/sql/models/instance-methods.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Instance Methods","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Model Hooks & Lifecycle","permalink":"/hysteria-orm/databases/sql/models/hooks"},"next":{"title":"Database Views","permalink":"/hysteria-orm/databases/sql/models/views"}}');var r=s(4848),i=s(8453);const a={title:"Instance Methods",sidebar_position:4},d="Instance Methods",o={},c=[{value:"Overview",id:"overview",level:2},{value:"Methods",id:"methods",level:2},{value:"<code>save()</code>",id:"save",level:3},{value:"<code>update(payload, options?)</code>",id:"updatepayload-options",level:3},{value:"<code>softDelete(options?, methodOptions?)</code>",id:"softdeleteoptions-methodoptions",level:3},{value:"<code>delete(options?)</code>",id:"deleteoptions",level:3},{value:"<code>refresh(options?)</code>",id:"refreshoptions",level:3},{value:"<code>mergeProps(data)</code>",id:"mergepropsdata",level:3},{value:"Chaining Instance Methods",id:"chaining-instance-methods",level:2},{value:"Best Practices",id:"best-practices",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"instance-methods",children:"Instance Methods"})}),"\n",(0,r.jsx)(n.p,{children:"Hysteria ORM models provide instance methods that allow you to work with individual model instances. These methods operate on the model instance itself and require the model to have a primary key defined."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Instance methods are called on model instances rather than the model class. They provide a convenient way to perform operations on a specific record."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," All instance methods require the model to have a primary key defined. If the model doesn't have a primary key, these methods will throw a ",(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,r.jsx)(n.h3,{id:"save",children:(0,r.jsx)(n.code,{children:"save()"})}),"\n",(0,r.jsx)(n.p,{children:"Saves the model instance to the database. If the primary key is not set, it performs an insert. If the primary key is set, it performs an update."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Insert a new record\nconst user = new User();\nuser.name = "John Doe";\nuser.email = "john@example.com";\nuser.age = 30;\nawait user.save();\n\n// Update an existing record\nconst existingUser = await User.findOne({ where: { id: 1 } });\nif (existingUser) {\n  existingUser.name = "Jane Doe";\n  await existingUser.save();\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Options:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"trx"}),": Transaction instance for running the operation within a transaction"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const trx = await sql.transaction();\ntry {\n  const user = new User();\n  user.name = "John Doe";\n  await user.save({ trx });\n  await trx.commit();\n} catch (error) {\n  await trx.rollback();\n  throw error;\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Throws:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY"})," if the model has no primary key defined"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"updatepayload-options",children:(0,r.jsx)(n.code,{children:"update(payload, options?)"})}),"\n",(0,r.jsx)(n.p,{children:"Updates the model instance in the database with the provided payload. The model must have a primary key value set."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const user = new User();\nuser.id = 1;\nuser.name = "John Doe";\nuser.email = "john@example.com";\n\n// Update specific fields\nawait user.update({\n  name: "Jane Doe",\n  age: 35,\n});\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"payload"}),": Partial object containing the fields to update"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"options"}),": Optional object with ",(0,r.jsx)(n.code,{children:"trx"})," for transaction support"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const trx = await sql.transaction();\ntry {\n  await user.update({ name: "Updated Name" }, { trx });\n  await trx.commit();\n} catch (error) {\n  await trx.rollback();\n  throw error;\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Throws:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY"})," if the model has no primary key defined"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY_VALUE"})," if the primary key value is not set"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"softdeleteoptions-methodoptions",children:(0,r.jsx)(n.code,{children:"softDelete(options?, methodOptions?)"})}),"\n",(0,r.jsx)(n.p,{children:"Soft deletes the model instance by setting the soft delete column to a value (default: current UTC datetime). The record remains in the database but is filtered out by default queries."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const user = await User.findOne({ where: { id: 1 } });\nif (user) {\n  await user.softDelete();\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"options"}),": Optional object with:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"column"}),": Custom column name for soft delete (default: ",(0,r.jsx)(n.code,{children:"deletedAt"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"value"}),": Custom value to set (default: current UTC datetime)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"methodOptions"}),": Optional object with ",(0,r.jsx)(n.code,{children:"trx"})," for transaction support"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Custom soft delete column and value\nconst customDate = new Date("2024-01-01");\nawait user.softDelete({\n  column: "deletedAt",\n  value: customDate,\n});\n\n// With transaction\nconst trx = await sql.transaction();\ntry {\n  await user.softDelete(undefined, { trx });\n  await trx.commit();\n} catch (error) {\n  await trx.rollback();\n  throw error;\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Throws:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY"})," if the model has no primary key defined"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY_VALUE"})," if the primary key value is not set"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," Soft deleted records are automatically filtered out by ",(0,r.jsx)(n.code,{children:"find"}),", ",(0,r.jsx)(n.code,{children:"findOne"}),", and other query methods unless you use ",(0,r.jsx)(n.code,{children:'ignoreHooks: ["beforeFetch"]'})," in your query options."]}),"\n",(0,r.jsx)(n.h3,{id:"deleteoptions",children:(0,r.jsx)(n.code,{children:"delete(options?)"})}),"\n",(0,r.jsx)(n.p,{children:"Permanently deletes the model instance from the database."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const user = await User.findOne({ where: { id: 1 } });\nif (user) {\n  await user.delete();\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Options:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"trx"}),": Transaction instance for running the operation within a transaction"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const trx = await sql.transaction();\ntry {\n  await user.delete({ trx });\n  await trx.commit();\n} catch (error) {\n  await trx.rollback();\n  throw error;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Throws:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY"})," if the model has no primary key defined"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY_VALUE"})," if the primary key value is not set"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"refreshoptions",children:(0,r.jsx)(n.code,{children:"refresh(options?)"})}),"\n",(0,r.jsx)(n.p,{children:"Refreshes the model instance from the database, updating all fields with the current values."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const user = await User.findOneByPrimaryKey(1);\n\n// Update the record directly in the database\nawait User.updateRecord(user, { name: "Updated Name", age: 40 });\n\n// Refresh the instance to get the latest data\nawait user.refresh();\n\nconsole.log(user.name); // "Updated Name"\nconsole.log(user.age); // 40\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Options:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"trx"}),": Transaction instance for running the operation within a transaction"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const trx = await sql.transaction();\ntry {\n  await User.updateRecord(user, { name: "Transaction Updated" }, { trx });\n  await user.refresh({ trx });\n  await trx.commit();\n} catch (error) {\n  await trx.rollback();\n  throw error;\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Throws:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY"})," if the model has no primary key defined"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HysteriaError"})," with code ",(0,r.jsx)(n.code,{children:"MODEL_HAS_NO_PRIMARY_KEY_VALUE"})," if the primary key value is not set"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"mergepropsdata",children:(0,r.jsx)(n.code,{children:"mergeProps(data)"})}),"\n",(0,r.jsx)(n.p,{children:"Merges the provided data with the model instance, updating only the specified properties."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const user = new User();\nuser.name = "John Doe";\nuser.email = "john@example.com";\nuser.age = 25;\n\n// Merge new values\nuser.mergeProps({\n  name: "Jane Doe",\n  age: 30,\n});\n\nconsole.log(user.name); // "Jane Doe"\nconsole.log(user.age); // 30\nconsole.log(user.email); // "john@example.com" (unchanged)\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"data"}),": Partial object containing the fields to merge"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"chaining-instance-methods",children:"Chaining Instance Methods"}),"\n",(0,r.jsx)(n.p,{children:"Instance methods can be chained together for convenient workflows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Create, update, refresh, and soft delete\nconst user = new User();\nuser.name = "Chain Test";\nuser.email = "chain@example.com";\nuser.age = 25;\n\nawait user.save(); // Insert\nawait user.update({ name: "Chain Updated" }); // Update\nawait User.updateRecord(user, { age: 50 }); // Update via static method\nawait user.refresh(); // Refresh to get latest data\nawait user.softDelete(); // Soft delete\n'})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"When to Use"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"save()"})}),(0,r.jsx)(n.td,{children:"Both inserts (no PK) and updates (has PK)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"update()"})}),(0,r.jsx)(n.td,{children:"Update specific fields only"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"refresh()"})}),(0,r.jsx)(n.td,{children:"After external updates to sync instance"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"softDelete()"})}),(0,r.jsx)(n.td,{children:"Preserve data for audit purposes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"delete()"})}),(0,r.jsx)(n.td,{children:"Permanently remove records"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"mergeProps()"})}),(0,r.jsx)(n.td,{children:"Update instance properties without saving"})]})]})]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Always check for null values when using ",(0,r.jsx)(n.code,{children:"findOne()"})," before calling instance methods."]})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:["Next: ",(0,r.jsx)(n.a,{href:"/hysteria-orm/databases/sql/models/views",children:"Model Views"})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);