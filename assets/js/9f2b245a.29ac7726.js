"use strict";(self.webpackChunkhysteria_orm_docs=self.webpackChunkhysteria_orm_docs||[]).push([[3122],{1146:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"databases/sql/query-builder/model-query-builder","title":"ModelQueryBuilder (Type-Safe)","description":"The ModelQueryBuilder is the primary, partially type-safe query API for Hysteria ORM models. All calls to User.query(), Post.query(), etc., return a ModelQueryBuilder instance.","source":"@site/docs/databases/sql/query-builder/model-query-builder.md","sourceDirName":"databases/sql/query-builder","slug":"/databases/sql/query-builder/model-query-builder","permalink":"/hysteria-orm/databases/sql/query-builder/model-query-builder","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/hysteria-orm/tree/main/website/docs/databases/sql/query-builder/model-query-builder.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"ModelQueryBuilder (Type-Safe)","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Query Builder Basics","permalink":"/hysteria-orm/databases/sql/query-builder/basics"},"next":{"title":"SQL Functions","permalink":"/hysteria-orm/databases/sql/query-builder/sql-functions"}}');var t=s(4848),i=s(8453);const l={title:"ModelQueryBuilder (Type-Safe)",sidebar_position:1},a="ModelQueryBuilder (Type-Safe)",c={},d=[{value:"Key Features",id:"key-features",level:2},{value:"Example Usage",id:"example-usage",level:2},{value:"Filtering",id:"filtering",level:2},{value:"Raw right-hand side with rawStatement",id:"raw-right-hand-side-with-rawstatement",level:3},{value:"Selecting Columns",id:"selecting-columns",level:2},{value:"Column Selection Formats",id:"column-selection-formats",level:3},{value:"Wildcards and JOINs",id:"wildcards-and-joins",level:3},{value:"Chaining Selects",id:"chaining-selects",level:3},{value:"Type Safety in Select",id:"type-safety-in-select",level:3},{value:"Basic Type Inference",id:"basic-type-inference",level:4},{value:"Alias Type Inference",id:"alias-type-inference",level:4},{value:"Wildcard Behavior",id:"wildcard-behavior",level:4},{value:"Qualified Columns",id:"qualified-columns",level:4},{value:"Custom Properties with <code>selectRaw</code>",id:"custom-properties-with-selectraw",level:4},{value:"Type Safety Summary",id:"type-safety-summary",level:4},{value:"Instance Methods on Query Results",id:"instance-methods-on-query-results",level:3},{value:"SQL Functions with selectFunc",id:"sql-functions-with-selectfunc",level:2},{value:"Supported Functions",id:"supported-functions",level:3},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Combining Aggregates",id:"combining-aggregates",level:3},{value:"With GROUP BY",id:"with-group-by",level:3},{value:"Alternative: getCount, getSum, etc.",id:"alternative-getcount-getsum-etc",level:3},{value:"Pagination",id:"pagination",level:2},{value:"Joins",id:"joins",level:2},{value:"Basic Joins",id:"basic-joins",level:3},{value:"Joins with Additional Conditions",id:"joins-with-additional-conditions",level:3},{value:"CTEs (Common Table Expressions)",id:"ctes-common-table-expressions",level:2},{value:"Pluck",id:"pluck",level:2},{value:"Increment / Decrement",id:"increment--decrement",level:2},{value:"Locking",id:"locking",level:2},{value:"clearSelect",id:"clearselect",level:2},{value:"Soft Delete",id:"soft-delete",level:2},{value:"Type Safety Example",id:"type-safety-example",level:2},{value:"Comparison to QueryBuilder",id:"comparison-to-querybuilder",level:2},{value:"Selected API Highlights",id:"selected-api-highlights",level:2}];function o(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"modelquerybuilder-type-safe",children:"ModelQueryBuilder (Type-Safe)"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"ModelQueryBuilder"})," is the primary, partially type-safe query API for Hysteria ORM models. All calls to ",(0,t.jsx)(n.code,{children:"User.query()"}),", ",(0,t.jsx)(n.code,{children:"Post.query()"}),", etc., return a ModelQueryBuilder instance.\nThe query builder is partially type safe, triggering intellisense for developer experience but still allowing the developer to write whatever he wants.\nThe ModelQueryBuilder by default returns a ",(0,t.jsx)(n.code,{children:"ModelWithoutRelations<T>"})," type, which is a type that does not have any relations. You can add Relations using the ",(0,t.jsx)(n.code,{children:"load"})," method."]}),"\n",(0,t.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Partially type-safe queries and results"}),"\n",(0,t.jsx)(n.li,{children:"Decorator and relation support"}),"\n",(0,t.jsx)(n.li,{children:"Rich API for filtering, selecting, joining, and more"}),"\n",(0,t.jsx)(n.li,{children:"Supports advanced features like CTEs, pagination, and soft deletes"}),"\n",(0,t.jsxs)(n.li,{children:["Model columns are parsed to database columns based on the case convention of the model, this applies both on column names like ",(0,t.jsx)(n.code,{children:"isActive"})," and on table.column scenarios like ",(0,t.jsx)(n.code,{children:"users.isActive"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const users = await User.query().where('status', 'active').many();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"filtering",children:"Filtering"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Here if model has snake case convention, the columns will be parsed to snake case\nconst users = await User.query().where('age', '>', 18).andWhere('isActive', true).andWhere('users.isActive', true).many();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"raw-right-hand-side-with-rawstatement",children:"Raw right-hand side with rawStatement"}),"\n",(0,t.jsxs)(n.p,{children:["When you need to compare a column to another column or an expression without creating a binding, use ",(0,t.jsx)(n.code,{children:"sql.rawStatement"}),". Identifiers inside the raw string are automatically quoted per database dialect."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// After connecting with SqlDataSource\nawait User.query()\n  .where('id', sql.rawStatement('user.id'))\n  .many();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"selecting-columns",children:"Selecting Columns"}),"\n",(0,t.jsxs)(n.p,{children:["By default, queries return all columns from the model's table. Use ",(0,t.jsx)(n.code,{children:"select()"})," to pick specific columns:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Only returns name and email\nconst users = await User.query()\n  .select('name', 'email')\n  .many();\n\n// TypeScript knows only name and email are available\nusers[0].name;  // \u2713 OK\nusers[0].email; // \u2713 OK\nusers[0].age;   // \u2717 Type error - not selected\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"warning",children:[(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"select()"})," method only allows selecting columns that are part of the model definition. For columns outside the model (e.g., computed columns, columns from unrelated tables, or raw expressions), use ",(0,t.jsx)(n.a,{href:"#raw-select-selectraw",children:(0,t.jsx)(n.code,{children:"selectRaw()"})})," instead:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// \u274c Error - 'metadata' is not a column in the User model\nawait User.query().select('metadata').many();\n\n// \u2705 Correct - use selectRaw for non-model columns\nawait User.query().selectRaw<{ metadata: string }>('metadata').many();\n"})})]}),"\n",(0,t.jsx)(n.h3,{id:"column-selection-formats",children:"Column Selection Formats"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Direct column names with intellisense\nconst users = await User.query()\n  .select('name', 'age', 'email')\n  .many();\n\n// Qualified columns (table.column) - useful with JOINs\nconst posts = await Post.query()\n  .select('posts.title', 'posts.content')\n  .leftJoin('users', 'users.id', 'posts.userId')\n  .many();\n\n// Column aliases using tuple syntax [column, alias]\nconst users = await User.query()\n  .select(['name', 'userName'], ['age', 'userAge'])\n  .many();\n\nusers[0].userName; // \u2713 OK (string - type from name)\nusers[0].userAge;  // \u2713 OK (number - type from age)\n\n// Wildcards - returns all model columns\nconst users = await User.query().select('*').many();\n"})}),"\n",(0,t.jsxs)(n.admonition,{title:"Avoid Using Wildcards",type:"warning",children:[(0,t.jsxs)(n.p,{children:["Using ",(0,t.jsx)(n.code,{children:"*"})," or ",(0,t.jsx)(n.code,{children:"table.*"})," in ",(0,t.jsx)(n.code,{children:"select()"})," is ",(0,t.jsx)(n.strong,{children:"discouraged"})," as it loses type safety benefits:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// \u274c Avoid: Loses type inference for other selections\nconst user = await User.query()\n  .select("*", ["name", "aliasedName"])  // aliasedName won\'t be typed!\n  .one();\n\n// \u2705 Preferred: Select specific columns for full type safety\nconst user = await User.query()\n  .select("id", "name", "email", ["name", "aliasedName"])\n  .one();\n\nuser.aliasedName; // \u2713 Properly typed as string\n'})}),(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"*"})," is present, the return type becomes ",(0,t.jsx)(n.code,{children:"ModelWithoutRelations<T>"}),", and any additional aliased columns from tuples will not be included in the type. Always prefer selecting specific columns for maximum type safety."]})]}),"\n",(0,t.jsx)(n.h3,{id:"wildcards-and-joins",children:"Wildcards and JOINs"}),"\n",(0,t.jsxs)(n.p,{children:["When using wildcards with JOINs, columns from joined tables are ",(0,t.jsx)(n.strong,{children:"automatically filtered out"})," to prevent data bleeding:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// users columns are filtered out, only Post columns appear\nconst posts = await Post.query()\n  .select('posts.*')\n  .leftJoin('users', 'users.id', 'posts.userId')\n  .many();\n\nposts[0].title;   // \u2713 OK (Post column)\nposts[0].name;    // \u2717 Filtered out (User column)\n\n// To include columns from joined tables, use explicit aliases\nconst posts = await Post.query()\n  .select('posts.*', ['users.name', 'authorName'])\n  .leftJoin('users', 'users.id', 'posts.userId')\n  .many();\n\nposts[0].title;      // \u2713 OK (Post column)\nposts[0].authorName; // \u2713 OK (explicitly aliased)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"chaining-selects",children:"Chaining Selects"}),"\n",(0,t.jsxs)(n.p,{children:["Multiple ",(0,t.jsx)(n.code,{children:"select()"})," calls accumulate at runtime:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const users = await User.query()\n  .select('name')\n  .select('age')  // Both name and age are selected\n  .many(); // returns { name: string; age: number }\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": TypeScript reflects the type of the ",(0,t.jsx)(n.strong,{children:"last"})," ",(0,t.jsx)(n.code,{children:"select()"})," call. If you need all columns typed, include them in a single ",(0,t.jsx)(n.code,{children:"select()"})," call."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"type-safety-in-select",children:"Type Safety in Select"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"select()"})," method is fully type-safe. TypeScript infers the return type based on which columns you select."]}),"\n",(0,t.jsx)(n.h4,{id:"basic-type-inference",children:"Basic Type Inference"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Model definition\nclass User extends Model {\n  @column({ primaryKey: true })\n  declare id: number;\n\n  @column()\n  declare name: string;\n\n  @column()\n  declare email: string;\n\n  @column()\n  declare age: number;\n}\n\n// Selecting specific columns - return type is { name: string; email: string }\nconst user = await User.query()\n  .select('name', 'email')\n  .one();\n\nuser?.name;   // \u2713 string\nuser?.email;  // \u2713 string\nuser?.age;    // \u2717 Type error - property 'age' does not exist\nuser?.id;     // \u2717 Type error - property 'id' does not exist\n"})}),"\n",(0,t.jsx)(n.h4,{id:"alias-type-inference",children:"Alias Type Inference"}),"\n",(0,t.jsxs)(n.p,{children:["When using ",(0,t.jsx)(n.code,{children:"[column, alias]"})," tuple syntax, TypeScript creates the aliased property with the original column's type:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const user = await User.query()\n  .select(['name', 'userName'], ['age', 'userAge'])\n  .one();\n\nuser?.userName;  // \u2713 string (type from 'name')\nuser?.userAge;   // \u2713 number (type from 'age')\nuser?.name;      // \u2717 Type error - use the alias instead\n"})}),"\n",(0,t.jsx)(n.h4,{id:"wildcard-behavior",children:"Wildcard Behavior"}),"\n",(0,t.jsxs)(n.p,{children:["Using ",(0,t.jsx)(n.code,{children:"*"})," returns the full model type:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Returns ModelWithoutRelations<User> (all columns)\nconst users = await User.query()\n  .select('*')\n  .many();\n\nusers[0].id;     // \u2713 number\nusers[0].name;   // \u2713 string\nusers[0].email;  // \u2713 string\nusers[0].age;    // \u2713 number\n"})}),"\n",(0,t.jsx)(n.h4,{id:"qualified-columns",children:"Qualified Columns"}),"\n",(0,t.jsx)(n.p,{children:"Table-qualified columns extract the column name for typing:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const result = await User.query()\n  .select('users.name', 'users.age')\n  .many();\n\nresult[0].name;  // \u2713 string (extracted from 'users.name')\nresult[0].age;   // \u2713 number (extracted from 'users.age')\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"custom-properties-with-selectraw",children:["Custom Properties with ",(0,t.jsx)(n.code,{children:"selectRaw"})]}),"\n",(0,t.jsx)(n.p,{children:"For custom expressions, use the type parameter to define the return shape:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const result = await User.query()\n  .select('name')\n  .selectRaw<{ totalOrders: number }>('COUNT(orders.id) as totalOrders')\n  .one();\n\nresult?.name;         // \u2713 string (from select)\nresult?.totalOrders;  // \u2713 number (from selectRaw type parameter)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"type-safety-summary",children:"Type Safety Summary"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Selection"}),(0,t.jsx)(n.th,{children:"Return Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:["No ",(0,t.jsx)(n.code,{children:"select()"})]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"ModelWithoutRelations<T>"})," (all columns)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"select('*')"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"ModelWithoutRelations<T>"})," (all columns)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"select('col1', 'col2')"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"{ col1: Type1; col2: Type2 }"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"select(['col', 'alias'])"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"{ alias: ColType }"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"select('table.col')"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"{ col: ColType }"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"selectRaw<T>(...)"})}),(0,t.jsxs)(n.td,{children:["Merges ",(0,t.jsx)(n.code,{children:"T"})," with current selection"]})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"instance-methods-on-query-results",children:"Instance Methods on Query Results"}),"\n",(0,t.jsxs)(n.p,{children:["All query results from the ",(0,t.jsx)(n.code,{children:"ModelQueryBuilder"})," include instance methods (",(0,t.jsx)(n.code,{children:"save"}),", ",(0,t.jsx)(n.code,{children:"update"}),", ",(0,t.jsx)(n.code,{children:"delete"}),", ",(0,t.jsx)(n.code,{children:"softDelete"}),", ",(0,t.jsx)(n.code,{children:"refresh"}),", ",(0,t.jsx)(n.code,{children:"mergeProps"}),") regardless of whether you use ",(0,t.jsx)(n.code,{children:".select()"})," or not:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Without select - full model with instance methods\nconst user = await User.query().where('id', 1).one();\nif (user) {\n  await user.update({ name: \"New Name\" });\n  await user.refresh();\n  await user.delete();\n}\n\n// With select - partial data but still has instance methods\nconst user = await User.query()\n  .select('id', 'name')\n  .where('id', 1)\n  .one();\n\nif (user) {\n  user.mergeProps({ name: \"Updated\" });\n  await user.save();     // \u2713 Available\n  await user.update({ name: \"Another\" }); // \u2713 Available\n  await user.delete();   // \u2713 Available\n  await user.refresh();  // \u2713 Available\n}\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Instance methods require the primary key to be present in the result. If you use ",(0,t.jsx)(n.code,{children:".select()"})," without including the primary key, methods like ",(0,t.jsx)(n.code,{children:"save()"}),", ",(0,t.jsx)(n.code,{children:"update()"}),", and ",(0,t.jsx)(n.code,{children:"delete()"})," will throw an error."]})}),"\n",(0,t.jsx)(n.h2,{id:"sql-functions-with-selectfunc",children:"SQL Functions with selectFunc"}),"\n",(0,t.jsxs)(n.p,{children:["Hysteria ORM provides a unified ",(0,t.jsx)(n.code,{children:"selectFunc()"})," method for SQL functions with ",(0,t.jsx)(n.strong,{children:"auto-inferred return types"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// Return types are automatically inferred!\nconst result = await User.query()\n  .selectFunc("count", "*", "totalUsers")  // totalUsers: number\n  .selectFunc("avg", "age", "avgAge")      // avgAge: number\n  .selectFunc("upper", "name", "upperName") // upperName: string\n  .one();\n\nresult?.totalUsers; // number\nresult?.avgAge;     // number\nresult?.upperName;  // string\n'})}),"\n",(0,t.jsx)(n.h3,{id:"supported-functions",children:"Supported Functions"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Functions"}),(0,t.jsx)(n.th,{children:"Return Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"count"}),", ",(0,t.jsx)(n.code,{children:"sum"}),", ",(0,t.jsx)(n.code,{children:"avg"}),", ",(0,t.jsx)(n.code,{children:"min"}),", ",(0,t.jsx)(n.code,{children:"max"}),", ",(0,t.jsx)(n.code,{children:"length"}),", ",(0,t.jsx)(n.code,{children:"abs"}),", ",(0,t.jsx)(n.code,{children:"round"}),", ",(0,t.jsx)(n.code,{children:"ceil"}),", ",(0,t.jsx)(n.code,{children:"floor"}),", ",(0,t.jsx)(n.code,{children:"sqrt"})]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"number"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"upper"}),", ",(0,t.jsx)(n.code,{children:"lower"}),", ",(0,t.jsx)(n.code,{children:"trim"})]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Custom functions"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"any"})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// COUNT all rows\nconst result = await User.query()\n  .selectFunc("count", "*", "totalUsers")\n  .one();\n\nconsole.log(result?.totalUsers); // number\n\n// SUM\nconst result = await Order.query()\n  .selectFunc("sum", "amount", "totalRevenue")\n  .one();\n\n// AVG\nconst result = await Product.query()\n  .selectFunc("avg", "price", "averagePrice")\n  .one();\n\n// MIN / MAX\nconst result = await User.query()\n  .selectFunc("min", "age", "youngestAge")\n  .selectFunc("max", "age", "oldestAge")\n  .one();\n'})}),"\n",(0,t.jsx)(n.h3,{id:"combining-aggregates",children:"Combining Aggregates"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const stats = await User.query()\n  .selectFunc("count", "*", "totalUsers")\n  .selectFunc("min", "age", "minAge")\n  .selectFunc("max", "age", "maxAge")\n  .selectFunc("avg", "age", "avgAge")\n  .one();\n\n// { totalUsers: 100, minAge: 18, maxAge: 85, avgAge: 35.5 }\n'})}),"\n",(0,t.jsx)(n.h3,{id:"with-group-by",children:"With GROUP BY"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const salesByCategory = await Product.query()\n  .select("category")\n  .selectFunc("sum", "price", "totalSales")\n  .selectFunc("count", "*", "productCount")\n  .groupBy("category")\n  .orderBy("totalSales", "desc")\n  .many();\n'})}),"\n",(0,t.jsx)(n.h3,{id:"alternative-getcount-getsum-etc",children:"Alternative: getCount, getSum, etc."}),"\n",(0,t.jsx)(n.p,{children:"For simple cases where you just need a single aggregate value:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// Using getCount (returns just the number)\nconst count = await User.query()\n  .where("status", "active")\n  .getCount();\n// Returns: 42\n\n// Equivalent using selectFunc (returns object with property)\nconst result = await User.query()\n  .where("status", "active")\n  .selectFunc("count", "*", "count")\n  .one();\n// Returns: { count: 42 }\n'})}),"\n",(0,t.jsxs)(n.p,{children:["For more SQL functions (string, numeric, null handling) and ",(0,t.jsx)(n.code,{children:"selectRaw"}),", see: ",(0,t.jsx)(n.a,{href:"/hysteria-orm/databases/sql/query-builder/sql-functions",children:"SQL Functions"})]}),"\n",(0,t.jsx)(n.h2,{id:"pagination",children:"Pagination"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const page = await User.query().paginate(1, 10);\nconsole.log(page.data, page.paginationMetadata);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"joins",children:"Joins"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Joins do not use the joined table hooks, only the caller model hooks are used"}),"\n",(0,t.jsx)(n.li,{children:"Joined model columns are cased based on the case convention of the model"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"basic-joins",children:"Basic Joins"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const postsWithUsers = await Post.query()\n  .select('posts.*', 'users.name')\n  .join('users', 'posts.userId', 'users.id')\n  .many();\n\nconst postsWithUsersFromModel = await Post.query()\n  .select('posts.*', 'users.name')\n  .join(User, 'userId', 'id')\n  .many();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"joins-with-additional-conditions",children:"Joins with Additional Conditions"}),"\n",(0,t.jsx)(n.p,{children:"You can add additional conditions to the join ON clause by passing a callback as the last parameter:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const postsWithActiveUsers = await Post.query()\n  .select('posts.*')\n  .join(\n    'users',\n    'users.id',\n    'posts.userId',\n    (q) => q.where('users.isActive', true)\n  )\n  .many();\n\n// This generates SQL similar to:\n// SELECT posts.* FROM posts\n// INNER JOIN users ON users.id = posts.userId AND users.isActive = true\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The callback receives a ",(0,t.jsx)(n.code,{children:"JoinOnQueryBuilder"})," that supports all where methods:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Multiple conditions\nawait Post.query()\n  .join(\n    'users',\n    'users.id',\n    'posts.userId',\n    (q) => q\n      .where('users.isActive', true)\n      .andWhere('users.verified', true)\n  )\n  .many();\n\n// Using different operators\nawait Post.query()\n  .innerJoin(\n    User,\n    'id',\n    'userId',\n    (q) => q\n      .whereIn('users.status', ['active', 'pending'])\n      .andWhere('users.age', '>=', 18)\n  )\n  .many();\n\n// Works with all join types: join, innerJoin, leftJoin, rightJoin, fullJoin\nawait Post.query()\n  .leftJoin(\n    'comments',\n    'comments.postId',\n    'posts.id',\n    (q) => q.where('comments.approved', true)\n  )\n  .many();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"ctes-common-table-expressions",children:"CTEs (Common Table Expressions)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const users = await User.query()\n  .with('users_cte', (qb) => qb.select('name').where('isActive', true))\n  .many();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"pluck",children:"Pluck"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const names = await User.query().pluck('name'); // string[]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"increment--decrement",children:"Increment / Decrement"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"await User.query().increment('age', 1);\nawait User.query().decrement('age', 1);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"locking",children:"Locking"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const users = await User.query().lockForUpdate().many();\nconst users = await User.query().forShare().many();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"clearselect",children:"clearSelect"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const users = await User.query().select('name').clearSelect().many();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"soft-delete",children:"Soft Delete"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"await User.query().softDelete({ column: 'deleted_at' });\n"})}),"\n",(0,t.jsx)(n.h2,{id:"type-safety-example",children:"Type Safety Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// users: ModelWithoutRelations<User>\nconst users = await User.query().where('email', 'like', '%@example.com').many();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"comparison-to-querybuilder",children:"Comparison to QueryBuilder"}),"\n",(0,t.jsxs)(n.p,{children:["For raw SQL reference (filtering, joins, pagination, streaming, chunking), see: ",(0,t.jsx)(n.a,{href:"/hysteria-orm/databases/sql/query-builder/",children:"QueryBuilder (Raw SQL)"})]}),"\n",(0,t.jsx)(n.h2,{id:"selected-api-highlights",children:"Selected API Highlights"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Filtering: ",(0,t.jsx)(n.code,{children:"where"}),", ",(0,t.jsx)(n.code,{children:"orWhere"}),", ",(0,t.jsx)(n.code,{children:"andWhere"}),", ",(0,t.jsx)(n.code,{children:"whereIn"}),", ",(0,t.jsx)(n.code,{children:"whereNull"}),", ",(0,t.jsx)(n.code,{children:"whereBetween"}),", ",(0,t.jsx)(n.code,{children:"whereLike"}),", ",(0,t.jsx)(n.code,{children:"whereExists"})]}),"\n",(0,t.jsxs)(n.li,{children:["Joins: ",(0,t.jsx)(n.code,{children:"join"}),", ",(0,t.jsx)(n.code,{children:"leftJoin"}),", ",(0,t.jsx)(n.code,{children:"rightJoin"}),", ",(0,t.jsx)(n.code,{children:"innerJoin"})]}),"\n",(0,t.jsxs)(n.li,{children:["Aggregates: ",(0,t.jsx)(n.code,{children:"getCount"}),", ",(0,t.jsx)(n.code,{children:"getMax"}),", ",(0,t.jsx)(n.code,{children:"getMin"}),", ",(0,t.jsx)(n.code,{children:"getAvg"}),", ",(0,t.jsx)(n.code,{children:"getSum"}),", ",(0,t.jsx)(n.code,{children:"selectFunc"})]}),"\n",(0,t.jsxs)(n.li,{children:["Select: ",(0,t.jsx)(n.code,{children:"select"}),", ",(0,t.jsx)(n.code,{children:"selectRaw"}),", ",(0,t.jsx)(n.code,{children:"selectFunc"}),", ",(0,t.jsx)(n.code,{children:"clearSelect"})]}),"\n",(0,t.jsxs)(n.li,{children:["Pagination: ",(0,t.jsx)(n.code,{children:"paginate"}),", ",(0,t.jsx)(n.code,{children:"paginateWithCursor"}),", ",(0,t.jsx)(n.code,{children:"limit"}),", ",(0,t.jsx)(n.code,{children:"offset"}),", ",(0,t.jsx)(n.code,{children:"chunk"})]}),"\n",(0,t.jsxs)(n.li,{children:["Relations: ",(0,t.jsx)(n.code,{children:"load"}),", ",(0,t.jsx)(n.code,{children:"clearRelations"}),", ",(0,t.jsx)(n.code,{children:"havingRelated"}),", ",(0,t.jsx)(n.code,{children:"notHavingRelated"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Refer to the tests under ",(0,t.jsx)(n.code,{children:"test/sql"})," for comprehensive examples aligned with the implementation."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:["Next: ",(0,t.jsx)(n.a,{href:"/hysteria-orm/databases/sql/query-builder/",children:"QueryBuilder (Raw SQL)"})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var r=s(6540);const t={},i=r.createContext(t);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);