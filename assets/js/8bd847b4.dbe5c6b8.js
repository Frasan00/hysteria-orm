"use strict";(self.webpackChunkhysteria_orm_docs=self.webpackChunkhysteria_orm_docs||[]).push([[1168],{1524:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"databases/sql/patterns","title":"ORM Patterns","description":"Hysteria ORM supports two distinct patterns for working with your database models:","source":"@site/docs/databases/sql/patterns.md","sourceDirName":"databases/sql","slug":"/databases/sql/patterns","permalink":"/hysteria-orm/databases/sql/patterns","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/hysteria-orm/tree/main/website/docs/databases/sql/patterns.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"ORM Patterns","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"SQL ORM Introduction","permalink":"/hysteria-orm/databases/sql/introduction"},"next":{"title":"Defining SQL Models","permalink":"/hysteria-orm/databases/sql/models/basics"}}');var t=s(4848),i=s(8453);const d={title:"ORM Patterns",sidebar_position:2},l="ORM Patterns",c={},a=[{value:"Active Record Pattern",id:"active-record-pattern",level:2},{value:"How it Works",id:"how-it-works",level:3},{value:"Example Usage",id:"example-usage",level:3},{value:"Available Static Methods",id:"available-static-methods",level:3},{value:"Benefits",id:"benefits",level:3},{value:"Model Embedding with Active Record",id:"model-embedding-with-active-record",level:3},{value:"Repository Pattern (getModelManager)",id:"repository-pattern-getmodelmanager",level:2},{value:"How it Works",id:"how-it-works-1",level:3},{value:"Example Usage",id:"example-usage-1",level:3},{value:"When to Use Repository Pattern",id:"when-to-use-repository-pattern",level:3},{value:"Example with Dependency Injection",id:"example-with-dependency-injection",level:3},{value:"Example with Custom Connection",id:"example-with-custom-connection",level:3},{value:"Pattern Comparison",id:"pattern-comparison",level:2},{value:"When to Use Each Pattern",id:"when-to-use-each-pattern",level:2},{value:"Migrating Between Patterns",id:"migrating-between-patterns",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"orm-patterns",children:"ORM Patterns"})}),"\n",(0,t.jsx)(n.p,{children:"Hysteria ORM supports two distinct patterns for working with your database models:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Active Record Pattern"})," - Static methods on model classes (recommended)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Repository Pattern"})," - Using ",(0,t.jsx)(n.code,{children:"getModelManager()"})," for dependency injection"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"active-record-pattern",children:"Active Record Pattern"}),"\n",(0,t.jsxs)(n.p,{children:["The Active Record pattern is the ",(0,t.jsx)(n.strong,{children:"recommended approach"})," for most applications. It provides a clean, intuitive API where you call static methods directly on your model classes."]}),"\n",(0,t.jsx)(n.h3,{id:"how-it-works",children:"How it Works"}),"\n",(0,t.jsxs)(n.p,{children:["In the Active Record pattern, your model classes have static methods that handle database operations. These methods internally use a ",(0,t.jsx)(n.code,{children:"ModelManager"})," instance but abstract away the complexity."]}),"\n",(0,t.jsx)(n.h3,{id:"example-usage",children:"Example Usage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { Model, column } from 'hysteria-orm';\n\nclass User extends Model {\n  @column.integer({ primaryKey: true })\n  declare id: number;\n\n  @column()\n  declare name: string;\n\n  @column()\n  declare email: string;\n}\n\n// Active Record Pattern - Static methods on the model\nconst user = await User.insert({ name: 'John', email: 'john@example.com' });\nconst users = await User.find({ where: { isActive: true } });\nconst userById = await User.findOneByPrimaryKey(1);\nconst query = User.query().where('name', 'like', '%John%').many();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"available-static-methods",children:"Available Static Methods"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Example"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.insert(data)"})}),(0,t.jsx)(n.td,{children:"Insert a new record"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.insert({ name: 'John' })"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.insertMany(data[])"})}),(0,t.jsx)(n.td,{children:"Insert multiple records"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.insertMany([{ name: 'John' }, { name: 'Jane' }])"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.find(options)"})}),(0,t.jsx)(n.td,{children:"Find multiple records"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.find({ where: { isActive: true } })"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.findOne(options)"})}),(0,t.jsx)(n.td,{children:"Find a single record"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.findOne({ where: { email: 'john@example.com' } })"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.findBy(column, value)"})}),(0,t.jsx)(n.td,{children:"Find by specific column"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.findBy('email', 'john@example.com')"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.findOneBy(column, value)"})}),(0,t.jsx)(n.td,{children:"Find one by specific column"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.findOneBy('email', 'john@example.com')"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.findOneByPrimaryKey(id)"})}),(0,t.jsx)(n.td,{children:"Find by primary key"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.findOneByPrimaryKey(1)"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.update(data, options)"})}),(0,t.jsx)(n.td,{children:"Update records"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.update({ name: 'Johnny' }, { where: { id: 1 } })"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.delete(options)"})}),(0,t.jsx)(n.td,{children:"Delete records"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.delete({ where: { isActive: false } })"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.query()"})}),(0,t.jsx)(n.td,{children:"Get query builder"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.query().where('age', '>', 18).many()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.all()"})}),(0,t.jsx)(n.td,{children:"Get all records"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.all()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.count(options)"})}),(0,t.jsx)(n.td,{children:"Count records"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.count({ where: { isActive: true } })"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Model.exists(options)"})}),(0,t.jsx)(n.td,{children:"Check if records exist"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"User.exists({ where: { email: 'john@example.com' } })"})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"benefits",children:"Benefits"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Clean API"}),": Simple, intuitive method calls"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Type Safety"}),": Full TypeScript support with proper typing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Model Awareness"}),": Automatic handling of decorators, relations, and hooks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Less Boilerplate"}),": No need to manage ModelManager instances"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Familiar"}),": Similar to other popular ORMs like TypeORM"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Model Embedding Support"}),": Can be used with embedded models for even cleaner syntax"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"model-embedding-with-active-record",children:"Model Embedding with Active Record"}),"\n",(0,t.jsx)(n.p,{children:"Model embedding allows you to attach models directly to a SQL data source instance, providing an even cleaner API:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const sql = new SqlDataSource({\n  type: 'postgres',\n  models: { user: User, post: Post },\n});\nawait sql.connect();\n\n// Access models directly through the data source\nconst user = await sql.user.insert({ name: 'John', email: 'john@example.com' });\nconst users = await sql.user.find({ where: { isActive: true } });\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For detailed documentation, see ",(0,t.jsx)(n.a,{href:"/hysteria-orm/databases/sql/advanced/model-embedding",children:"Model Embedding"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"repository-pattern-getmodelmanager",children:"Repository Pattern (getModelManager)"}),"\n",(0,t.jsx)(n.p,{children:"The Repository pattern provides more control and is useful for dependency injection, testing, or when you need explicit control over the data source connection."}),"\n",(0,t.jsx)(n.h3,{id:"how-it-works-1",children:"How it Works"}),"\n",(0,t.jsxs)(n.p,{children:["Instead of using static methods, you get a ",(0,t.jsx)(n.code,{children:"ModelManager"})," instance from the data source and use its methods directly."]}),"\n",(0,t.jsx)(n.h3,{id:"example-usage-1",children:"Example Usage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { SqlDataSource, Model, column } from 'hysteria-orm';\n\nclass User extends Model {\n  @column.integer({ primaryKey: true })\n  declare id: number;\n\n  @column()\n  declare name: string;\n\n  @column()\n  declare email: string;\n}\n\n// Connect first\nconst sql = new SqlDataSource({ type: 'postgres', ... });\nawait sql.connect();\n\n// Repository Pattern - Using getModelManager\nconst userManager = sql.getModelManager(User);\n\nconst user = await userManager.insert({ name: 'John', email: 'john@example.com' });\nconst users = await userManager.find({ where: { isActive: true } });\nconst userById = await userManager.findOneByPrimaryKey(1);\nconst query = userManager.query().where('name', 'like', '%John%').many();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"when-to-use-repository-pattern",children:"When to Use Repository Pattern"}),"\n",(0,t.jsx)(n.p,{children:"The Repository pattern is useful when you need:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Dependency Injection"}),": Pass the manager to services or controllers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Testing"}),": Mock the manager for unit tests"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Multiple Connections"}),": Use different data sources for the same model"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Explicit Control"}),": Want to manage the data source connection explicitly"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"example-with-dependency-injection",children:"Example with Dependency Injection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Service class that accepts a ModelManager\nclass UserService {\n  constructor(private userManager: ModelManager<User>) {}\n\n  async createUser(userData: Partial<User>) {\n    return await this.userManager.insert(userData);\n  }\n\n  async findActiveUsers() {\n    return await this.userManager.find({\n      where: { isActive: true }\n    });\n  }\n}\n\n// Usage\nconst userManager = sql.getModelManager(User);\nconst userService = new UserService(userManager);\nconst users = await userService.findActiveUsers();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"example-with-custom-connection",children:"Example with Custom Connection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Using a secondary connection\nconst secondarySql = await SqlDataSource.connectToSecondarySource({\n  type: 'postgres',\n  host: 'read-replica.example.com',\n  // ... other config\n});\n\nconst readOnlyUserManager = secondarySql.getModelManager(User);\nconst users = await readOnlyUserManager.find({ where: { isActive: true } });\n"})}),"\n",(0,t.jsx)(n.h2,{id:"pattern-comparison",children:"Pattern Comparison"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Feature"}),(0,t.jsx)(n.th,{children:"Active Record"}),(0,t.jsx)(n.th,{children:"Model Embedding"}),(0,t.jsx)(n.th,{children:"Repository Pattern"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"API Simplicity"})}),(0,t.jsx)(n.td,{children:"\u2705 Simple"}),(0,t.jsx)(n.td,{children:"\u2705 Cleanest"}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f Verbose"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Type Safety"})}),(0,t.jsx)(n.td,{children:"\u2705 Full"}),(0,t.jsx)(n.td,{children:"\u2705 Full"}),(0,t.jsx)(n.td,{children:"\u2705 Full"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Dependency Injection"})}),(0,t.jsx)(n.td,{children:"\u274c Limited"}),(0,t.jsx)(n.td,{children:"\u2705 Perfect"}),(0,t.jsx)(n.td,{children:"\u2705 Perfect"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Testing"})}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f Harder"}),(0,t.jsx)(n.td,{children:"\u2705 Easy"}),(0,t.jsx)(n.td,{children:"\u2705 Easy"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Multiple Connections"})}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f Limited"}),(0,t.jsx)(n.td,{children:"\u2705 Full"}),(0,t.jsx)(n.td,{children:"\u2705 Full"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"when-to-use-each-pattern",children:"When to Use Each Pattern"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Pattern"}),(0,t.jsx)(n.th,{children:"Best For"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Active Record"})}),(0,t.jsx)(n.td,{children:"Simple apps, quick prototypes, default connection"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Model Embedding"})}),(0,t.jsx)(n.td,{children:"Service architecture, dependency injection, microservices"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Repository Pattern"})}),(0,t.jsx)(n.td,{children:"Enterprise apps, fine-grained control, multiple connections"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"migrating-between-patterns",children:"Migrating Between Patterns"}),"\n",(0,t.jsxs)(n.p,{children:["All patterns use the same underlying ",(0,t.jsx)(n.code,{children:"ModelManager"}),", so you can switch as your application grows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Start with Active Record\nconst user = await User.insert({ name: 'John' });\n\n// Upgrade to Model Embedding\nconst sql = new SqlDataSource({\n  type: 'postgres',\n  models: { user: User },\n});\n\nconst user = await sql.user.insert({ name: 'John' });\n\n// Or use Repository Pattern\nconst userManager = sql.getModelManager(User);\nconst user = await userManager.insert({ name: 'John' });\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:["Next: ",(0,t.jsx)(n.a,{href:"/hysteria-orm/databases/sql/models/basics",children:"Defining Models"})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var r=s(6540);const t={},i=r.createContext(t);function d(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);